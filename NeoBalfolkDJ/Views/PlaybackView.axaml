<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:NeoBalfolkDJ.ViewModels"
             mc:Ignorable="d" d:DesignWidth="400" d:DesignHeight="450"
             x:Class="NeoBalfolkDJ.Views.PlaybackView"
             x:DataType="vm:PlaybackViewModel">
    
    <Design.DataContext>
        <vm:PlaybackViewModel/>
    </Design.DataContext>
    
    <Grid RowDefinitions="Auto">
        <!-- Playback Panel at the top -->
        <Border Grid.Row="0"
                BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}" 
                BorderThickness="1" 
                CornerRadius="8"
                Padding="16">
            <Grid RowDefinitions="Auto,Auto,Auto,Auto">
                <!-- Dance Name (normal mode - not message) -->
                <TextBlock Grid.Row="0" 
                           Text="{Binding DanceName}" 
                           FontSize="18" 
                           FontWeight="Bold"
                           HorizontalAlignment="Center"
                           TextTrimming="CharacterEllipsis"
                           Margin="0,0,0,8"
                           IsVisible="{Binding !IsMessageMode}"/>
                
                <!-- Dance Name (message mode - scrolling) -->
                <Border Grid.Row="0"
                        ClipToBounds="True"
                        HorizontalAlignment="Stretch"
                        Height="26"
                        Margin="0,0,0,8"
                        IsVisible="{Binding IsMessageMode}">
                    <Canvas x:Name="MessageCanvas" ClipToBounds="True">
                        <TextBlock x:Name="MessageTextBlock"
                                   Text="{Binding DanceName}" 
                                   FontSize="18" 
                                   FontWeight="Bold"
                                   Canvas.Left="0"/>
                    </Canvas>
                </Border>
                
                <!-- Artist and Title on same line (when track loaded) -->
                <Border Grid.Row="1"
                        ClipToBounds="True"
                        HorizontalAlignment="Stretch"
                        Height="28"
                        Margin="0,0,0,16"
                        IsVisible="{Binding HasTrack}">
                    <Canvas x:Name="TrackInfoCanvas" ClipToBounds="True">
                        <StackPanel x:Name="TrackInfoPanel"
                                    Orientation="Horizontal"
                                    Canvas.Left="0">
                            <TextBlock Text="{Binding ArtistName}" 
                                       FontSize="16"
                                       VerticalAlignment="Center"/>
                            <TextBlock Text=" â€” " 
                                       FontSize="16"
                                       Opacity="0.6"
                                       VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding TrackTitle}" 
                                       FontSize="16"
                                       FontStyle="Italic"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                    </Canvas>
                </Border>
                
                <!-- Placeholder when no track -->
                <TextBlock Grid.Row="1"
                           Text="..."
                           FontSize="16"
                           HorizontalAlignment="Center"
                           Margin="0,0,0,16"
                           IsVisible="{Binding !HasTrack}"/>
                
                <!-- Progress Bar with Time -->
                <Grid Grid.Row="2" ColumnDefinitions="Auto,*,Auto" Margin="0,0,0,16">
                    <TextBlock Grid.Column="0" 
                               Text="{Binding CurrentTime}" 
                               VerticalAlignment="Center"
                               Margin="0,0,8,0"/>
                    <ProgressBar Grid.Column="1" 
                                 Minimum="0" 
                                 Maximum="{Binding Duration}" 
                                 Value="{Binding Progress}"
                                 Height="8"
                                 VerticalAlignment="Center"/>
                    <TextBlock Grid.Column="2" 
                               Text="{Binding TotalTime}" 
                               VerticalAlignment="Center"
                               Margin="8,0,0,0"/>
                </Grid>
                
                <!-- Playback Controls -->
                <StackPanel Grid.Row="3" 
                            Orientation="Horizontal" 
                            HorizontalAlignment="Center"
                            Spacing="16">
                    <Button Command="{Binding PlayPauseCommand}" 
                            Width="60" 
                            Height="40"
                            HorizontalContentAlignment="Center"
                            VerticalContentAlignment="Center">
                        <Panel>
                            <PathIcon Data="M8,5.14V19.14L19,12.14L8,5.14Z" IsVisible="{Binding !IsPlaying}"/>
                            <PathIcon Data="M14,19H18V5H14M6,19H10V5H6V19Z" IsVisible="{Binding IsPlaying}"/>
                        </Panel>
                    </Button>
                    <Button Command="{Binding RestartCommand}" 
                            Width="60" 
                            Height="40"
                            HorizontalContentAlignment="Center"
                            VerticalContentAlignment="Center"
                            ToolTip.Tip="Restart track">
                        <PathIcon Data="M12,5V1L7,6L12,11V7A6,6 0 0,1 18,13A6,6 0 0,1 12,19A6,6 0 0,1 6,13H4A8,8 0 0,0 12,21A8,8 0 0,0 20,13A8,8 0 0,0 12,5Z"/>
                    </Button>
                    <Button Command="{Binding NextOrClearCommand}" 
                            Width="60" 
                            Height="40"
                            HorizontalContentAlignment="Center"
                            VerticalContentAlignment="Center">
                        <Panel>
                            <!-- Next track icon - shown when queue has items -->
                            <PathIcon Data="M16,18H18V6H16M6,18L14.5,12L6,6V18Z" 
                                      IsVisible="{Binding ShowNextIcon}"/>
                            <!-- Clear/X icon - shown when queue is empty -->
                            <PathIcon Data="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" 
                                      IsVisible="{Binding !ShowNextIcon}"/>
                        </Panel>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>
